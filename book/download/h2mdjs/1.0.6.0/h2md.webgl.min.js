(function(){/*
 Copyright 2015-2016 AXELL Corporation.
 H2MD WebGL Renderer
 version 1.0.6.0
*/
function h(a,c,b){this.a=null;this.h=[];this.w=null;this.l=Array(this.L);this.v=this.m=this.o=null;this.B=0;this.i=!1;this.s=this.u=0;this.f=[];this.g=[];var f=m(a,c);b&&p?(f=b.id,this.i=!1):this.i=!0;b=this.a=q[f];var g;g=b.D;this.o=b.getUniformLocation(g,"tex_sampler");this.m=b.getUniformLocation(g,"fb_size");this.v=b.getUniformLocation(g,"tx_size");this.B=f;for(b=0;b<r;b++){g=this.l;var n=b,k=t(a),l=t(c),d=this.a,e=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,e);var v=d.createTexture();
d.bindTexture(d.TEXTURE_2D,v);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,k,l,0,d.RGBA,d.UNSIGNED_BYTE,null);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,v,0);d.bindTexture(d.TEXTURE_2D,null);d.bindFramebuffer(d.FRAMEBUFFER,null);d={};d.J=e;d.t=v;this.c=k;this.b=l;g[n]=d}this.C=u[f].width;this.A=u[f].height;for(a=0;a<w;a++)this.h[a]=a==x||a==y?this.l[a].t:this.a.createTexture()}
var q=[],u=[],p=!1,z=!0,A=!1;function m(a,c){for(var b=512;a>b||c>b;)b*=2;return b}var r=2,w=3,x=0,y=1,B=6,B=4096*B;
h.prototype.H=function(a){C(this);this.j=a;this.a.bindFramebuffer(this.a.FRAMEBUFFER,this.l[a].J);a=this.a;this.a.activeTexture(a.TEXTURE0);this.a.bindTexture(a.TEXTURE_2D,this.h[0]);this.a.activeTexture(a.TEXTURE1);this.a.bindTexture(a.TEXTURE_2D,this.h[1]);this.a.activeTexture(a.TEXTURE2);this.a.bindTexture(a.TEXTURE_2D,this.h[2]);this.a.viewport(0,0,this.c,this.b);a.uniform2f(this.m,1/this.c*2,1/this.b*2);a.disable(a.BLEND)};
h.prototype.F=function(){this.f.length=0;this.g.length=0;this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT)};
h.prototype.I=function(a){D(this,this.f,2);var c=a,b=this.w;a=this.a;a.activeTexture(a.TEXTURE2);if(this.u<c.width||this.s<c.height)b=!1;b?a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,c):(c.width!=c.height&&(b=document.createElement("canvas"),b.width=t(c.width),b.height=t(c.height),b.getContext("2d").drawImage(c,0,0),c=b),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,
a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.u=c.width,this.s=c.height);this.w=!0};h.prototype.drawImage=function(a,c,b,f,g,n,k,l,d){var e=this.f;2!=a.id&&(e=this.g);E(this,e,c,b,f,g,n,-(this.b-k),l,d)};
h.prototype.G=function(a,c,b,f,g,n,k,l,d){C(this);var e=this.a;e.bindFramebuffer(this.a.FRAMEBUFFER,null);this.i?(e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ZERO,e.ONE,e.ZERO)):(e.enable(e.BLEND),"lighter"==d?e.blendFuncSeparate(e.SRC_ALPHA,e.ONE,e.SRC_ALPHA,e.ONE):e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA));e.uniform1i(this.o,this.j);e.viewport(0,0,this.C,this.A);e.uniform2f(this.v,1/this.c,1/this.b);e.uniform2f(this.m,1/this.C*2,1/this.A*-2);
d=[];this.i?E(this,d,0,0,this.c,this.b,0,0,this.c,this.b):E(this,d,a,c,b,f,g,n,k,l);D(this,d,-1);e.disable(e.BLEND);return u[this.B]};window.H2MD_WebGL=h;
h.initialize=function(a,c,b){if(z){if(-1==window.navigator.userAgent.toLowerCase().indexOf("chrome"))return!1}else if(0==A)return!1;if(4096<a||4096<c)return!1;a=m(a,c);b&&p&&(a=b.id);if(!u[a]){b&&b.id==a?u[a]=b:(u[a]=document.createElement("canvas"),u[a].width=a,u[a].height=a);q[a]=u[a].getContext("webgl");if(!q[a])return u[a]=null,!1;b=q[a];c=b.createShader(b.VERTEX_SHADER);var f=b.createShader(b.FRAGMENT_SHADER);if(c&&f){b.shaderSource(c,"attribute vec4 vPosition;\nuniform vec2 fb_size;\nuniform vec2 tx_size;\nvarying vec2 texCoord;\nconst vec2 base_const=vec2(-1,1);\nvoid main()\n{\n\tgl_Position = vec4(vPosition.xy * fb_size + base_const,0,1);\n\ttexCoord.xy = vPosition.zw * tx_size;\n}");
b.shaderSource(f,"precision mediump float;\nuniform sampler2D tex_sampler;\nvarying vec2 texCoord;\nvoid main()\n{\n\tgl_FragColor = texture2D(tex_sampler, texCoord);\n}");b.compileShader(c);b.compileShader(f);var g=b.createProgram();b.attachShader(g,c);b.attachShader(g,f);b.bindAttribLocation(g,0,"vPosition");b.enableVertexAttribArray(0);b.linkProgram(g);b.D=g;b.disable(b.BLEND);b.useProgram(b.D);b=!0}else b=!1;if(!b)return u[a]=null,!1;a=q[a];b=Array(B);c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,
c);a.bufferData(a.ARRAY_BUFFER,new Float32Array(b),a.DYNAMIC_DRAW);c.K=4;c.M=b.length/2;a.vertexAttribPointer(0,c.K,a.FLOAT,!1,0,0)}return!0};h.directComposite=function(a){p=a};h.setWebGLEnable=function(a){z=!1;A=a};h.prototype.setFrameBuffer=h.prototype.H;h.prototype.clearRect=h.prototype.F;h.prototype.drawImage=h.prototype.drawImage;h.prototype.setTexture=h.prototype.I;h.prototype.composite=h.prototype.G;
function E(a,c,b,f,g,n,k,l,d,e){c.push(k+d,l,b+g,f,k,l,b,f,k+d,l+e,b+g,f+n,k,l,b,f,k+d,l+e,b+g,f+n,k,l+e,b,f+n);a.f.length>=B&&D(a,a.f,2);a.g.length>=B&&D(a,a.g,1-a.j)}function C(a){D(a,a.f,2);D(a,a.g,1-a.j)}function D(a,c,b){if(0!=c.length){var f=a.a;if(-1!=b){f.uniform1i(a.o,b);var g;2!=b?(b=a.c,g=a.b):(b=a.u,g=a.s);f.uniform2f(a.v,1/b,1/g)}f.bufferSubData(f.ARRAY_BUFFER,0,new Float32Array(c));f.drawArrays(f.TRIANGLES,0,c.length/4);c.length=0}}function t(a){for(var c=32;a>c;)c*=2;return c};})();
